<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search :</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/range.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script type="text/javascript" src="/script/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
</head>

<body>
    <% include paritials/navbar.ejs %>
    <!-- Info Modal -->
    <div class="modal fade" id="filter" role="dialog" style="z-index: 9999; display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 style="font-weight:bold;">Filter</h3>
                    <button type="button" class="close" data-dismiss="modal">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="col-auto my-1">
                        <div class="container-fluid m-2">
                            <div id="rangeBox">
                                <label>Age</label>
                                <div id="sliderBox">
                                    <input type="range" id="slider0to50" step="5" min="0" max="50" />
                                    <input type="range" id="slider51to100" step="5" min="50" max="100" />
                                </div>
                                <div id="inputRange">
                                    <input type="number" step="5" min="0" max="50" placeholder="Min" id="min" />
                                    <input type="number" step="5" min="51" max="100" placeholder="Max" id="max" />
                                </div>
                            </div>
                        </div>

                        <div>
                            <label>Education</label>
                            <select class="custom-select mr-sm-2" id="education">
                                <option selected>Choose...</option>
                                <option value="10th">10th</option>
                                <option value="12th">12th</option>
                                <option value="Graduate">Graduate</option>
                                <option value="Post-Graduate">Post-Graduate</option>
                            </select>
                        </div>

                        <div>
                            <label>Religion</label>
                            <select class="custom-select mr-sm-2" id="religion">
                                <option selected>Choose...</option>
                                <option value="Hindu">Hindu</option>
                                <option value="Muslim">Muslim</option>
                                <option value="Christanity">Christanity</option>
                            </select>
                        </div>

                        <div>
                            <label>Height</label>
                            <br />

                            <input type="text" value="" />
                        </div>

                        <div class="col-auto my-1">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="customControlAutosizing" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        Close
                    </button>
                    <button type="button" class="btn btn-default" onclick="searchdata()">
                        Search
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid ml-lg-3 mr-lg-3 p-3 col-12 d-inline-flex">
        <div class="row col-10">
            <input class="form-control col-10" id="searchinput" type="search" placeholder="Search"
                aria-label="Search" />
            <button class="btn btn-outline-success" type="submit">Search</button>
        </div>
        <a class="nav-link col-2" href="#" data-toggle="modal" data-target="#filter">
            <i class="fa fa-filter logo" style="font-size: 25px;"></i>
        </a>
    </div>
    <div class="container-fluid p-2" id="maincontainer">
        <!-- <div class="container mr-auto border border-dark rounded">
            <div id="can-create-community">
                <div class="col-sm-12" style="display: flex;">
                    <div class="col-sm-2" style="padding:10px;flex:1;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/8/81/Salman_Khan_filmfare.jpg"
                            class="cpic img-fluid" style="width: 200px;height: 200px;" />
                    </div>

                    <div class="col-sm-10 text-lg-left" style="padding:20px;">
                        <h4><b>Name :</b>Salaman Khan</h4>
                        <h4><b>Age :</b>21</h4>
                        <h4><b>Hightest Education :</b>10th</h4>
                        <h4><b>Religion :</b>Hindu</h4>
                    </div>
                </div>
            </div>
        </div> -->
    </div>

    <script>
        var sliderLeft = document.getElementById("slider0to50");
        var sliderRight = document.getElementById("slider51to100");
        var inputMin = document.getElementById("min");
        var inputMax = document.getElementById("max");

        ///value updation from input to slider
        //function input update to slider
        function sliderLeftInput() {
            //input udate slider left
            sliderLeft.value = inputMin.value;
        }

        function sliderRightInput() {
            //input update slider right
            sliderRight.value = inputMax.value; //chnage in input max updated in slider right
        }

        //calling function on change of inputs to update in slider
        inputMin.addEventListener("change", sliderLeftInput);
        inputMax.addEventListener("change", sliderRightInput);

        ///value updation from slider to input
        //functions to update from slider to inputs
        function inputMinSliderLeft() {
            //slider update inputs
            inputMin.value = sliderLeft.value;
        }

        function inputMaxSliderRight() {
            //slider update inputs
            inputMax.value = sliderRight.value;
        }
        sliderLeft.addEventListener("change", inputMinSliderLeft);
        sliderRight.addEventListener("change", inputMaxSliderRight);

        //start here

        var start = 0;
        var end = 4;
        var tempdata = [];

        var totaldata;
        $(document).ready(function () {
            initalise();
        })

        function initalise() {
            let obj = {
                start: start,
                end: end,
            }
            document.getElementById("maincontainer").innerHTML = "";
            document.getElementById('searchinput').innerHTML = "";
            var xml = new XMLHttpRequest()
            xml.open("POST", "/userTable/getAllByPagingfunction")
            xml.onload = function () {
                document.getElementById('searchinput').innerHTML = "";
                var d = JSON.parse(xml.responseText);
                console.log(d);
                tempdata = d;
                for (var i = 0; i < tempdata.length; i++) {
                    addToDOM(tempdata[i])
                }

            }
            xml.setRequestHeader("Content-Type", "application/json");
            xml.send(JSON.stringify(obj));
        }

        function searchdata() {
            let obj = {
                minage: document.getElementById("min").value,
                maxage: document.getElementById("max").value,
                education: document.getElementById("education").value,
                religion: document.getElementById("religion").value,
                start: start,
                end: end,
            }
            document.getElementById('searchinput').innerHTML = "";
            document.getElementById("maincontainer").innerHTML = ""
            var xml = new XMLHttpRequest()
            xml.open("POST", "/userTable/getLimitedByPagingfunction")
            xml.onload = function () {
                document.getElementById('searchinput').innerHTML = "";
                var d = JSON.parse(xml.responseText);
                if (d == [] || d == null)
                    return;
                console.log(d);
                tempdata = d;
                for (var i = 0; i < tempdata.length; i++) {
                    addToDOM(tempdata[i])
                }

            }
            xml.setRequestHeader("Content-Type", "application/json");
            console.log(obj)
            xml.send(JSON.stringify(obj));
        }

        function getDocumentHeight() {
            console.log("getDocumentHeight");
            const body = document.body;
            const html = document.documentElement;

            return Math.max(
                body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight
            );
        }

        function getScrollTop() {
            return (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body
                .parentNode || document.body).scrollTop;
        }

        window.onscroll = function () {
            if (getScrollTop() == getDocumentHeight() - window.innerHeight) {
                start += 4;
                end = 4;
                initalise();
            } else
                return;
        }

        function addToDOM(obj) {
            var div1 = `<div id="${obj._id}" class="container mr-auto border border-dark mb-3 rounded" style="background-color:#d6d6d6">
            <div id="card">
                <div class="col-sm-12" style="display: flex;">
                    <div class="col-sm-2" style="padding:10px;flex:1;">
                        <img src="${obj.photourl}"
                            class="pic figure-img img-fluid" style="width: 200px;height: 200px;" />
                    </div>

                    <div class="col-sm-10 text-lg-left" style="padding:20px;">
                        <h4><b>Name :</b>${obj.firstname} ${obj.personaldetails.lastname}</h4>
                        <h4><b>Age :</b>${obj.personaldetails.age}</h4>
                        <h4><b>Hightest Education :</b>${obj.personaldetails.education}</h4>
                        <h4><b>Religion :</b>${obj.personaldetails.religion}</h4>
                    </div>
                </div>
            </div>
        </div>`
            document.getElementById('maincontainer').innerHTML = document.getElementById('maincontainer').innerHTML +
                div1;
        }

        function closeDragElement() {
            /* stop moving when mouse button is released:*/
            document.onmouseup = null;
            document.onmousemove = null;
        }

        document.getElementById('searchinput').onkeyup = function () {
            document.getElementById('search').innerHTML = ""
            var val = document.getElementById('searchinput').value;
            for (i in tempdata) {

                if ((tempdata[i].name).includes(val) || (tempdata[i].description).includes(val))
                    addToDOM(tempdata[i])
            }
        }
    </script>
</body>

</html>